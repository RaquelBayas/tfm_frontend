<div class="container-xl px-4 mt-4">
  <h2>Editar perfil</h2>
  <div
    class="alert"
    [ngClass]="{
      'alert-success': emailUpdated,
      'alert-danger': emailUpdateError
    }"
    *ngIf="showAlert"
  >
    {{
      emailUpdated
        ? "¡Correo electrónico actualizado correctamente!"
        : "Error al actualizar el correo electrónico."
    }}
  </div>

  <div class="row">
    <div class="col-xl-4">
      <div class="card mb-4 mb-xl-0">
        <div class="card-header">Foto de perfil</div>
        <div class="card-body text-center">
          <img
            class="form-control-file img-account-profile rounded-circle mb-2"
            [src]="profileImageUrl"
            *ngIf="profileImageUrl; else defaultImage"
            alt="Foto de perfil"
            style="width: 200px"
          />
          <ng-template #defaultImage>
            <img
              class="img-fluid rounded-circle mb-3"
              src="https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541"
              alt="Imagen predeterminada"
            />
          </ng-template>
          <label for="profile-image"></label>
          <input
            type="file"
            id="profile-image"
            class="form-control-file"
            (change)="handleProfileImageChange($event)"
          />
        </div>
      </div>
    </div>
    <div class="col-xl-8">
      <app-alert-error *ngIf="missingPasswordAlert">
        Introduce tu contraseña actual
      </app-alert-error>
      <app-alert-error *ngIf="oldPasswordAlert">
        Contraseña actual errónea
      </app-alert-error>
      <app-alert-error *ngIf="passwordMismatchAlert">
        Las contraseñas no coinciden
      </app-alert-error>
      <div class="row">
        <div class="col-xl-12">
          <div class="card mb-4">
            <div class="card-header">Actualizar nombre de usuario</div>
            <div class="card-body">
              <form>
                <div class="form-group">
                  <label for="username">Nombre de usuario:</label>
                  <input
                    type="text"
                    id="username"
                    class="form-control"
                    [(ngModel)]="username"
                    name="username"
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary"
                  (click)="updateUsername()"
                >
                  Guardar cambios
                </button>
              </form>
            </div>
          </div>
        </div>
        <div class="col-xl-12">
          <div class="card mb-4">
            <div class="card-header">Actualizar contraseña</div>
            <div class="card-body">
              <form>
                <div class="form-group">
                  <label for="password">Contraseña actual:</label>
                  <div class="input-group">
                    <input
                      type="password"
                      id="password"
                      class="form-control"
                      [(ngModel)]="password"
                      name="password"
                    />
                    <div class="input-group-append">
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="togglePasswordVisibility('password')"
                      >
                        <span
                          class="fas"
                          [ngClass]="{
                            'fa-eye': showPassword,
                            'fa-eye-slash': !showPassword
                          }"
                        ></span>
                      </button>
                    </div>
                  </div>
                </div>
                <div class="form-group">
                  <label for="newPassword">Nueva contraseña:</label>
                  <div class="input-group">
                    <input
                      type="password"
                      id="newPassword"
                      class="form-control"
                      [(ngModel)]="newPassword"
                      name="newPassword"
                    />
                    <div class="input-group-append">
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="togglePasswordVisibility('newPassword')"
                      >
                        <span
                          class="fas"
                          [ngClass]="{
                            'fa-eye': showNewPassword,
                            'fa-eye-slash': !showNewPassword
                          }"
                        ></span>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="confirmPassword">Confirmar contraseña:</label>
                  <div class="input-group">
                    <input
                      type="password"
                      id="confirmPassword"
                      class="form-control"
                      [(ngModel)]="confirmPassword"
                      name="confirmPassword"
                    />
                    <div class="input-group-append">
                      <button
                        class="btn btn-outline-secondary"
                        type="button"
                        (click)="togglePasswordVisibility('confirmPassword')"
                      >
                        <span
                          class="fas"
                          [ngClass]="{
                            'fa-eye': showConfirmPassword,
                            'fa-eye-slash': !showConfirmPassword
                          }"
                        ></span>
                      </button>
                    </div>
                  </div>
                </div>
                <button
                  type="submit"
                  class="btn btn-primary"
                  (click)="updatePassword()"
                >
                  Guardar cambios
                </button>
              </form>
            </div>
          </div>
        </div>
        <div class="col-xl-12">
          <div class="card mb-4">
            <div class="card-header">Actualizar correo electrónico</div>
            <div class="card-body">
              <form>
                <div class="form-group">
                  <label for="newEmail">Nuevo correo electrónico:</label>
                  <input
                    type="email"
                    id="newEmail"
                    class="form-control"
                    [(ngModel)]="newEmail"
                    name="newEmail"
                  />
                </div>
                <button
                  type="submit"
                  class="btn btn-primary"
                  (click)="updateEmail()"
                >
                  Guardar cambios
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
